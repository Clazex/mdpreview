var app=new Vue({el:"#app",data:{urlInput:"https://cdn.jsdelivr.net/gh/Sciencmine/mdpreview@latest/example.md",source:"",compiled:"",statusCode:200,langChoice:"English",options:{showSource:!1,shouldSanitize:!0,showControl:!0,showCredit:!0},i18n:{},langs:[{displayName:"English",id:"en_us",content:{title:"Markdown Preview",language:"Language: ",mdUrl:"Markdown File URL: ",load:"Load",source:"Show Source",sanitize:"Sanitize HTML",poweredBy:"Powered By: ",connectionFailure:"Connection failed",connectionError:"Error ",langUnknown:"Unknown language!",queryParseError:"Error when parsing queries!",queryUnknownKey:"Unknown query key: "}},{displayName:"简体中文",id:"zh_cn",content:{title:"Markdown 预览",language:"语言：",mdUrl:"Markdown 文件 URL：",load:"加载",source:"显示源代码",sanitize:"净化 HTML",poweredBy:"技术支持：",connectionFailure:"连接失败",connectionError:"错误 ",langUnknown:"未知语言！",queryParseError:"解析请求时出错！",queryUnknownKey:"未知请求键值："}},{displayName:"繁體中文",id:"zh_tw",content:{title:"Markdown 預覽",language:"語言：",mdUrl:"Markdown 檔案 URL：",load:"加載",source:"顯示源代碼",sanitize:"淨化 HTML",poweredBy:"技術支持：",connectionFailure:"連接失敗",connectionError:"錯誤 ",langUnknown:"未知語言！",queryParseError:"解析請求時出錯！",queryUnknownKey:"未知請求鍵值："}}]},methods:{loadMd:function(){superagent.get(app.urlInput).end((function(error,response){null===error?(200!==response.statusCode&&alert(app.i18n.connectionError+response.statusCode+"\n\n"+response.text),app.statusCode=response.statusCode,app.source=response.text,app.compile()):alert(app.i18n.connectionFailure+"\n"+error)}))},compile:function(){var markedProcessed=marked(app.source);app.options.shouldSanitize?app.compiled=DOMPurify.sanitize(markedProcessed):app.compiled=markedProcessed},string2bool:function(value){return"true"===value||"1"===value},loadQuery:function(){if(window.location.search.length>1){for(var j,searchList="&"+window.location.search.substr(1),i=0,parseFinished=!1;!parseFinished&&i>=0;){if(-1===(j=searchList.indexOf("=",i))){alert(app.i18n.queryParseError);break}var key=searchList.substr(i+1,j-i-1);switch(-1===(i=searchList.indexOf("&",j))&&(parseFinished=!0,i=searchList.length),console.log(key),console.log(searchList.substr(j+1,i-j-1)),key){case"source":app.options.showSource=app.string2bool(searchList.substr(j+1,i-j-1));break;case"sanitize":app.options.shouldSanitize=app.string2bool(searchList.substr(j+1,i-j-1));break;case"control":app.options.showControl=app.string2bool(searchList.substr(j+1,i-j-1));break;case"credit":app.options.showCredit=app.string2bool(searchList.substr(j+1,i-j-1));break;case"lang":for(var langId=searchList.substr(j+1,i-j-1),k=0;k<app.langs.length;k++)if(app.langs[k].id===langId){app.langChoice=app.langs[k].displayName;break}k===app.langs.length&&alert(app.i18n.langUnknown);break;case"url":i="hasUrl";break;default:return void alert(app.i18n.queryUnknownKey+key)}}"hasUrl"===i&&(app.urlInput=unescape(searchList.substr(j+1)),app.loadMd())}},loadI18n:function(){for(var i=0;i<app.langs.length;i++)if(app.langs[i].displayName===app.langChoice)return app.i18n=app.langs[i].content,void(document.title=app.i18n.title);alert(app.i18n.langUnknown)},init:function(){app.loadI18n(),app.loadQuery(),app.loadI18n()}}});